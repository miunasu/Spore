# 恶意软件分析

本文档提供恶意软件逆向分析的思路和关键 API。

## 快速分类

| 目标 | 方法 | 关键 API |
|------|------|----------|
| 提取字符串 | 遍历字符串列表，过滤 URL/IP/路径 | `ida_strlist.get_strlist_item()`, `idc.get_strlit_contents()` |
| 检查导入表 | 识别可疑 API（网络/注入/持久化） | `idautils.Names()`, `idautils.XrefsTo()` |
| 识别加密 | 搜索加密常量（S-box/MD5 init） | `ida_bytes.bin_search()` |
| 生成 YARA | 提取代码特征 | 使用 `mkyara.py` 脚本 |

## 深度分析

| 目标 | 方法 | 关键 API |
|------|------|----------|
| 定位入口 | 从 main/WinMain/DllMain 开始 | `idc.get_inf_attr(INF_START_EA)` |
| 追踪 API 调用 | 交叉引用找调用位置 | `idautils.XrefsTo()`, `idc.is_call_insn()` |
| 反编译函数 | 获取伪代码理解逻辑 | `ida_hexrays.decompile()` |
| 递归分析 | 自动分析调用链 | 使用 `reai.py` 脚本 |

## 行为特征识别

| 目标 | 方法 | 关键 API |
|------|------|----------|
| 进程注入 | 找 VirtualAllocEx/WriteProcessMemory/CreateRemoteThread | `idautils.XrefsTo()` |
| 持久化 | 找 RegSetValueEx/CreateService/schtasks | `idc.get_name_ea_simple()` |
| 反调试 | 找 IsDebuggerPresent/NtQueryInformationProcess | `idautils.XrefsTo()` |
| 网络通信 | 找 WSAStartup/connect/InternetOpen | `idautils.XrefsTo()` |
| 文件操作 | 找 CreateFile/DeleteFile/MoveFile | `idautils.XrefsTo()` |
