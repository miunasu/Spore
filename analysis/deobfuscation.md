# 反混淆

本文档提供代码混淆识别和去混淆的方法。

## 基本方法

| 场景 | 方法 | 关键 API/工具 |
|------|------|---------------|
| 控制流平坦化 | 识别分发器，还原 CFG | 手动分析或第三方工具 |
| 字符串加密 | 定位解密函数，批量调用 | `idautils.XrefsTo()` 找高频调用函数 |
| 虚拟机保护 | 分析 handler 表 | `ida_bytes.get_bytes()`, `idautils.Heads()` |

## 代码混淆识别

| 混淆类型 | 特征 | 分析方法 |
|----------|------|----------|
| 花指令 | 无效跳转、死代码 | `ida_ua.decode_insn()` 分析跳转目标 |
| 指令替换 | 等价指令序列 | 模式匹配识别 |
| 控制流平坦化 | switch 分发器 | `ida_gdl.FlowChart()` 分析 CFG |
| 不透明谓词 | 恒真/恒假条件 | 符号执行分析 |
| 调用混淆 | 间接调用、动态解析 | `idautils.XrefsFrom()` 分析调用目标 |

## 字符串解密

| 目标 | 方法 | 关键 API |
|------|------|----------|
| 定位解密函数 | 找被大量调用的小函数 | `idautils.XrefsTo()` 统计引用数 |
| 提取加密数据 | 读取调用参数 | `ida_hexrays.decompile()` |
| 批量解密 | 模拟或重实现解密 | 导出后脚本处理 |
